<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IELTS Lesson 19: Feedback Analysis & Improvement Plan</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .nav-buttons {
            display: flex;
            justify-content: space-between;
            padding: 20px 40px;
            background: #f8f9fa;
            flex-wrap: wrap;
            gap: 10px;
        }

        .nav-button {
            padding: 12px 24px;
            background: white;
            border: 2px solid #667eea;
            color: #667eea;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .nav-button:hover {
            background: #667eea;
            color: white;
        }

        .content {
            padding: 40px;
        }

        .section {
            margin-bottom: 50px;
        }

        .section h2 {
            color: #667eea;
            font-size: 2em;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
        }

        .section h3 {
            color: #764ba2;
            font-size: 1.5em;
            margin: 25px 0 15px 0;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .tab {
            padding: 15px 30px;
            background: #f0f0f0;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.1em;
            transition: all 0.3s;
        }

        .tab:hover {
            background: #e0e0e0;
        }

        .tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .info-box {
            background: #e8eaf6;
            padding: 20px;
            border-radius: 10px;
            border-left: 5px solid #667eea;
            margin: 20px 0;
        }

        .info-box strong {
            color: #667eea;
        }

        .interactive-area {
            background: #f9f9f9;
            padding: 30px;
            border-radius: 15px;
            margin: 25px 0;
        }

        /* Score Input Grid */
        .score-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .score-input {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #ddd;
        }

        .score-input label {
            display: block;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }

        .score-input select,
        .score-input input {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
        }

        /* Feedback Visualizer */
        .feedback-card {
            background: white;
            padding: 25px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 5px solid #667eea;
        }

        .feedback-card h4 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .strength-item,
        .weakness-item {
            padding: 12px;
            margin: 8px 0;
            border-radius: 8px;
            font-size: 1em;
        }

        .strength-item {
            background: #d4edda;
            border-left: 4px solid #28a745;
        }

        .weakness-item {
            background: #f8d7da;
            border-left: 4px solid #dc3545;
        }

        /* Band Gap Visualizer */
        .band-gap-display {
            background: white;
            padding: 30px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .band-row {
            display: flex;
            align-items: center;
            margin: 15px 0;
            gap: 15px;
        }

        .band-label {
            min-width: 150px;
            font-weight: bold;
            color: #667eea;
        }

        .band-bar {
            flex: 1;
            height: 40px;
            background: #e0e0e0;
            border-radius: 20px;
            position: relative;
            overflow: hidden;
        }

        .band-fill {
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: width 0.5s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .gap-indicator {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            margin-left: 10px;
        }

        .gap-small {
            background: #d4edda;
            color: #155724;
        }

        .gap-medium {
            background: #fff3cd;
            color: #856404;
        }

        .gap-large {
            background: #f8d7da;
            color: #721c24;
        }

        /* Improvement Roadmap */
        .roadmap-timeline {
            position: relative;
            padding: 20px 0;
        }

        .roadmap-item {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 5px solid #667eea;
            position: relative;
        }

        .roadmap-item::before {
            content: '';
            position: absolute;
            left: -12px;
            top: 25px;
            width: 20px;
            height: 20px;
            background: #667eea;
            border-radius: 50%;
            border: 4px solid white;
        }

        .roadmap-item h4 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .roadmap-item ul {
            margin-left: 25px;
            line-height: 1.8;
        }

        /* Priority Matrix */
        .priority-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin: 25px 0;
        }

        .priority-quadrant {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border: 3px solid;
            min-height: 200px;
        }

        .priority-high-urgent {
            border-color: #dc3545;
            background: #f8d7da;
        }

        .priority-high-not-urgent {
            border-color: #ffc107;
            background: #fff3cd;
        }

        .priority-low-urgent {
            border-color: #17a2b8;
            background: #d1ecf1;
        }

        .priority-low-not-urgent {
            border-color: #6c757d;
            background: #e2e3e5;
        }

        .priority-quadrant h4 {
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .priority-quadrant ul {
            list-style: none;
            padding: 0;
        }

        .priority-quadrant li {
            padding: 8px;
            margin: 5px 0;
            background: white;
            border-radius: 5px;
            cursor: move;
        }

        /* Action Button */
        .action-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 10px;
            font-size: 1.1em;
            cursor: pointer;
            margin: 10px 5px;
            transition: transform 0.2s;
        }

        .action-button:hover {
            transform: scale(1.05);
        }

        .action-button.secondary {
            background: #6c757d;
        }

        /* Checkbox List */
        .checklist {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .checklist-item {
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border: 2px solid #ddd;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .checklist-item:hover {
            background: #f8f9fa;
        }

        .checklist-item input[type="checkbox"] {
            width: 25px;
            height: 25px;
            cursor: pointer;
        }

        .checklist-item.completed {
            background: #d4edda;
            border-color: #28a745;
            opacity: 0.7;
        }

        /* Progress Tracker */
        .progress-container {
            margin: 30px 0;
        }

        .progress-bar {
            width: 100%;
            height: 40px;
            background: #e0e0e0;
            border-radius: 20px;
            overflow: hidden;
            margin: 15px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            width: 0%;
            transition: width 0.5s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .stats-row {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
            flex-wrap: wrap;
            gap: 15px;
        }

        .stat-box {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            min-width: 150px;
            border: 2px solid #667eea;
        }

        .stat-box .number {
            font-size: 2.5em;
            font-weight: bold;
            color: #667eea;
        }

        .stat-box .label {
            color: #666;
            margin-top: 5px;
        }

        /* Download Button */
        .download-button {
            background: #28a745;
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 10px;
            font-size: 1.1em;
            cursor: pointer;
            margin: 10px 5px;
            transition: all 0.3s;
        }

        .download-button:hover {
            background: #218838;
            transform: scale(1.05);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }
            .content {
                padding: 20px;
            }
            .tabs {
                flex-direction: column;
            }
            .priority-grid {
                grid-template-columns: 1fr;
            }
            .nav-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>IELTS Writing Task 2 - Lesson 19</h1>
            <p>Feedback Analysis & Improvement Plan</p>
        </div>

        <div class="nav-buttons">
            <a href="ielts_course_dashboard.html" class="nav-button">Back to Dashboard</a>
            <a href="ielts_lesson_18_exam_simulation.html" class="nav-button">Previous Lesson</a>
            <a href="ielts_lesson_20_final_strategies.html" class="nav-button">Next Lesson</a>
        </div>

        <div class="content">
            <!-- Navigation Tabs -->
            <div class="tabs">
                <button class="tab active" onclick="showTab('intro')">Introduction</button>
                <button class="tab" onclick="showTab('input')">Enter Your Scores</button>
                <button class="tab" onclick="showTab('analysis')">Band Gap Analysis</button>
                <button class="tab" onclick="showTab('roadmap')">Improvement Roadmap</button>
                <button class="tab" onclick="showTab('priorities')">Priority Tasks</button>
                <button class="tab" onclick="showTab('action')">Action Plan</button>
            </div>

            <!-- Tab 1: Introduction -->
            <div id="intro" class="tab-content active">
                <div class="section">
                    <h2>Welcome to Feedback Analysis</h2>
                    <p style="font-size: 1.1em; margin-bottom: 30px;">This lesson helps you understand your exam simulation results and create a personalized improvement plan to reach your target band score.</p>
                    
                    <div class="info-box">
                        <h3>What You Will Do in This Lesson:</h3>
                        <ul style="margin-left: 25px; margin-top: 10px; line-height: 1.8;">
                            <li>Enter your scores from Lesson 18 exam simulation</li>
                            <li>Analyze the gap between current and target scores</li>
                            <li>Identify your strengths and weaknesses by criterion</li>
                            <li>Create a personalized improvement roadmap</li>
                            <li>Prioritize tasks for maximum impact</li>
                            <li>Generate an actionable study plan</li>
                        </ul>
                    </div>

                    <div class="interactive-area">
                        <h3>Understanding Your Feedback</h3>
                        <p style="margin-bottom: 20px;">IELTS Writing Task 2 is scored on 4 criteria, each worth 25% of your final score:</p>
                        
                        <div class="feedback-card">
                            <h4>1. Task Response (TR)</h4>
                            <p>How well you answered the question. Did you address all parts? Is your position clear? Are ideas relevant and extended?</p>
                        </div>

                        <div class="feedback-card">
                            <h4>2. Coherence & Cohesion (CC)</h4>
                            <p>How well organized your essay is. Is there clear progression? Are paragraphs well-structured? Do linking words work naturally?</p>
                        </div>

                        <div class="feedback-card">
                            <h4>3. Lexical Resource (LR)</h4>
                            <p>Your vocabulary range and accuracy. Do you use less common words? Are collocations appropriate? Do errors impede meaning?</p>
                        </div>

                        <div class="feedback-card">
                            <h4>4. Grammatical Range & Accuracy (GRA)</h4>
                            <p>Your grammar variety and accuracy. Do you use complex structures? Are sentences error-free? Is punctuation correct?</p>
                        </div>
                    </div>

                    <div class="info-box" style="background: #fff3cd; border-left-color: #ffc107;">
                        <strong>IMPORTANT:</strong> To improve effectively, you need to know WHICH criterion is holding you back. A Band 7 student might score 8-8-6-7. The focus should be on improving that Band 6 score.
                    </div>
                </div>
            </div>

            <!-- Tab 2: Enter Scores -->
            <div id="input" class="tab-content">
                <div class="section">
                    <h2>Enter Your Exam Simulation Scores</h2>
                    <p style="font-size: 1.1em; margin-bottom: 30px;">Input the scores you received from your Lesson 18 exam simulation, and your target band score.</p>
                    
                    <div class="interactive-area">
                        <div class="score-grid">
                            <div class="score-input">
                                <label>Task Response (TR)</label>
                                <select id="tr-current">
                                    <option value="">Select score...</option>
                                    <option value="5">Band 5</option>
                                    <option value="5.5">Band 5.5</option>
                                    <option value="6">Band 6</option>
                                    <option value="6.5">Band 6.5</option>
                                    <option value="7">Band 7</option>
                                    <option value="7.5">Band 7.5</option>
                                    <option value="8">Band 8</option>
                                    <option value="8.5">Band 8.5</option>
                                    <option value="9">Band 9</option>
                                </select>
                            </div>

                            <div class="score-input">
                                <label>Coherence & Cohesion (CC)</label>
                                <select id="cc-current">
                                    <option value="">Select score...</option>
                                    <option value="5">Band 5</option>
                                    <option value="5.5">Band 5.5</option>
                                    <option value="6">Band 6</option>
                                    <option value="6.5">Band 6.5</option>
                                    <option value="7">Band 7</option>
                                    <option value="7.5">Band 7.5</option>
                                    <option value="8">Band 8</option>
                                    <option value="8.5">Band 8.5</option>
                                    <option value="9">Band 9</option>
                                </select>
                            </div>

                            <div class="score-input">
                                <label>Lexical Resource (LR)</label>
                                <select id="lr-current">
                                    <option value="">Select score...</option>
                                    <option value="5">Band 5</option>
                                    <option value="5.5">Band 5.5</option>
                                    <option value="6">Band 6</option>
                                    <option value="6.5">Band 6.5</option>
                                    <option value="7">Band 7</option>
                                    <option value="7.5">Band 7.5</option>
                                    <option value="8">Band 8</option>
                                    <option value="8.5">Band 8.5</option>
                                    <option value="9">Band 9</option>
                                </select>
                            </div>

                            <div class="score-input">
                                <label>Grammar Range & Accuracy (GRA)</label>
                                <select id="gra-current">
                                    <option value="">Select score...</option>
                                    <option value="5">Band 5</option>
                                    <option value="5.5">Band 5.5</option>
                                    <option value="6">Band 6</option>
                                    <option value="6.5">Band 6.5</option>
                                    <option value="7">Band 7</option>
                                    <option value="7.5">Band 7.5</option>
                                    <option value="8">Band 8</option>
                                    <option value="8.5">Band 8.5</option>
                                    <option value="9">Band 9</option>
                                </select>
                            </div>
                        </div>

                        <div class="score-grid" style="margin-top: 30px;">
                            <div class="score-input">
                                <label>Your Target Band Score</label>
                                <select id="target-score">
                                    <option value="">Select target...</option>
                                    <option value="6">Band 6.0</option>
                                    <option value="6.5">Band 6.5</option>
                                    <option value="7">Band 7.0</option>
                                    <option value="7.5">Band 7.5</option>
                                    <option value="8">Band 8.0</option>
                                </select>
                            </div>

                            <div class="score-input">
                                <label>Exam Date (if scheduled)</label>
                                <input type="date" id="exam-date">
                            </div>
                        </div>

                        <div style="text-align: center; margin-top: 30px;">
                            <button class="action-button" onclick="calculateAnalysis()">Calculate My Analysis</button>
                            <button class="action-button secondary" onclick="resetScores()">Reset</button>
                        </div>

                        <div id="overall-score" style="text-align: center; margin-top: 30px; display: none;">
                            <div class="feedback-card">
                                <h3 style="color: #667eea;">Your Overall Score</h3>
                                <div style="font-size: 3em; font-weight: bold; color: #667eea; margin: 20px 0;" id="overall-band">-</div>
                                <p style="font-size: 1.2em; color: #666;" id="gap-text">-</p>
                            </div>
                        </div>
                    </div>

                    <div class="info-box">
                        <strong>Note:</strong> Your overall Writing Task 2 score is the AVERAGE of your four criterion scores, rounded to the nearest 0.5. For example: 6.5 + 7 + 6 + 7 = 26.5 / 4 = 6.625, which rounds to Band 6.5.
                    </div>
                </div>
            </div>

            <!-- Tab 3: Band Gap Analysis -->
            <div id="analysis" class="tab-content">
                <div class="section">
                    <h2>Your Band Gap Analysis</h2>
                    <p style="font-size: 1.1em; margin-bottom: 30px;">This shows how close you are to your target score in each criterion.</p>
                    
                    <div class="interactive-area">
                        <div id="analysis-display">
                            <div class="info-box" style="text-align: center;">
                                <p style="font-size: 1.1em;">Please enter your scores in the "Enter Your Scores" tab first, then click "Calculate My Analysis".</p>
                            </div>
                        </div>
                    </div>

                    <div class="interactive-area" style="margin-top: 30px;">
                        <h3>Understanding Your Gaps</h3>
                        <div class="feedback-card">
                            <h4>Small Gap (0-0.5 bands)</h4>
                            <p>You're very close! Focus on fine-tuning and consistency. Review model essays and practice exam techniques.</p>
                        </div>

                        <div class="feedback-card">
                            <h4>Medium Gap (1-1.5 bands)</h4>
                            <p>You need focused practice in this area. Review the relevant lessons, do targeted exercises, and get feedback on practice essays.</p>
                        </div>

                        <div class="feedback-card">
                            <h4>Large Gap (2+ bands)</h4>
                            <p>This requires significant work. Revisit foundation lessons, do daily practice, and consider extra support from a teacher. This is your priority area.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab 4: Improvement Roadmap -->
            <div id="roadmap" class="tab-content">
                <div class="section">
                    <h2>Your Personalized Improvement Roadmap</h2>
                    <p style="font-size: 1.1em; margin-bottom: 30px;">A step-by-step plan based on your specific gaps.</p>
                    
                    <div class="interactive-area">
                        <div id="roadmap-display">
                            <div class="info-box" style="text-align: center;">
                                <p style="font-size: 1.1em;">Your personalized roadmap will appear here after you enter your scores and calculate the analysis.</p>
                            </div>
                        </div>
                    </div>

                    <div class="info-box">
                        <h3>How to Use Your Roadmap:</h3>
                        <ul style="margin-left: 25px; margin-top: 10px; line-height: 1.8;">
                            <li>Follow the phases in order - they build on each other</li>
                            <li>Spend more time on areas with larger gaps</li>
                            <li>Complete all tasks in Phase 1 before moving to Phase 2</li>
                            <li>Adjust timeline based on your exam date</li>
                            <li>Get regular feedback from a teacher if possible</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Tab 5: Priority Tasks -->
            <div id="priorities" class="tab-content">
                <div class="section">
                    <h2>Priority Task Matrix</h2>
                    <p style="font-size: 1.1em; margin-bottom: 30px;">Organize your improvement tasks by urgency and importance.</p>
                    
                    <div class="interactive-area">
                        <div id="priority-display">
                            <div class="info-box" style="text-align: center;">
                                <p style="font-size: 1.1em;">Your priority tasks will appear here after you enter your scores and calculate the analysis.</p>
                            </div>
                        </div>
                    </div>

                    <div class="info-box">
                        <h3>How to Prioritize:</h3>
                        <ul style="margin-left: 25px; margin-top: 10px; line-height: 1.8;">
                            <li><strong>High Importance + Urgent:</strong> Do these FIRST. These are your biggest gaps and have immediate impact.</li>
                            <li><strong>High Importance + Not Urgent:</strong> Schedule these next. Important for long-term improvement.</li>
                            <li><strong>Low Importance + Urgent:</strong> Quick wins. Do these when you have spare time.</li>
                            <li><strong>Low Importance + Not Urgent:</strong> Do these last, or skip if time is limited.</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Tab 6: Action Plan -->
            <div id="action" class="tab-content">
                <div class="section">
                    <h2>Your Weekly Action Plan</h2>
                    <p style="font-size: 1.1em; margin-bottom: 30px;">A concrete study schedule to reach your target score.</p>
                    
                    <div class="interactive-area">
                        <h3>Study Schedule Template</h3>
                        <p style="margin-bottom: 20px;">Based on your gaps and priorities, here's a recommended weekly schedule:</p>
                        
                        <div id="schedule-display">
                            <div class="info-box" style="text-align: center;">
                                <p style="font-size: 1.1em;">Your personalized weekly schedule will appear here after you enter your scores and calculate the analysis.</p>
                            </div>
                        </div>
                    </div>

                    <div class="interactive-area" style="margin-top: 30px;">
                        <h3>Your Personal Commitment</h3>
                        <p style="margin-bottom: 20px;">Check off these commitments to hold yourself accountable:</p>
                        
                        <div class="checklist">
                            <div class="checklist-item" onclick="toggleCheck(this)">
                                <input type="checkbox">
                                <label>I will follow my improvement roadmap consistently</label>
                            </div>
                            <div class="checklist-item" onclick="toggleCheck(this)">
                                <input type="checkbox">
                                <label>I will practice writing at least 3 times per week</label>
                            </div>
                            <div class="checklist-item" onclick="toggleCheck(this)">
                                <input type="checkbox">
                                <label>I will focus on my weakest criterion first</label>
                            </div>
                            <div class="checklist-item" onclick="toggleCheck(this)">
                                <input type="checkbox">
                                <label>I will seek feedback on my practice essays</label>
                            </div>
                            <div class="checklist-item" onclick="toggleCheck(this)">
                                <input type="checkbox">
                                <label>I will review model essays weekly</label>
                            </div>
                            <div class="checklist-item" onclick="toggleCheck(this)">
                                <input type="checkbox">
                                <label>I will do timed practice under exam conditions</label>
                            </div>
                            <div class="checklist-item" onclick="toggleCheck(this)">
                                <input type="checkbox">
                                <label>I will track my progress every 2 weeks</label>
                            </div>
                            <div class="checklist-item" onclick="toggleCheck(this)">
                                <input type="checkbox">
                                <label>I will stay motivated and not give up</label>
                            </div>
                        </div>

                        <div class="progress-container">
                            <h4 style="margin-bottom: 15px;">Your Commitment Progress</h4>
                            <div class="progress-bar">
                                <div class="progress-fill" id="commitment-progress">0%</div>
                            </div>
                        </div>
                    </div>

                    <div style="text-align: center; margin-top: 40px;">
                        <button class="download-button" onclick="downloadPlan()">Download My Improvement Plan</button>
                        <button class="action-button" onclick="window.location.href='ielts_lesson_20_final_strategies.html'">Go to Final Lesson</button>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <script>
        // Tab Switching
        function showTab(tabName) {
            const contents = document.querySelectorAll('.tab-content');
            contents.forEach(content => content.classList.remove('active'));
            
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        // Store scores globally
        let userScores = {
            tr: 0,
            cc: 0,
            lr: 0,
            gra: 0,
            target: 0,
            examDate: ''
        };

        // Calculate Analysis
        function calculateAnalysis() {
            // Get scores
            userScores.tr = parseFloat(document.getElementById('tr-current').value);
            userScores.cc = parseFloat(document.getElementById('cc-current').value);
            userScores.lr = parseFloat(document.getElementById('lr-current').value);
            userScores.gra = parseFloat(document.getElementById('gra-current').value);
            userScores.target = parseFloat(document.getElementById('target-score').value);
            userScores.examDate = document.getElementById('exam-date').value;

            // Validate
            if (!userScores.tr || !userScores.cc || !userScores.lr || !userScores.gra || !userScores.target) {
                alert('Please fill in all score fields before calculating!');
                return;
            }

            // Calculate overall
            const overall = (userScores.tr + userScores.cc + userScores.lr + userScores.gra) / 4;
            const rounded = Math.round(overall * 2) / 2; // Round to nearest 0.5
            const gap = userScores.target - rounded;

            // Display overall
            document.getElementById('overall-score').style.display = 'block';
            document.getElementById('overall-band').textContent = `Band ${rounded}`;
            
            let gapText = '';
            if (gap <= 0) {
                gapText = 'Congratulations! You have reached your target score!';
            } else if (gap <= 0.5) {
                gapText = `You are ${gap} band away from your target. Almost there!`;
            } else if (gap <= 1) {
                gapText = `You are ${gap} band away from your target. Focused practice will get you there!`;
            } else {
                gapText = `You are ${gap} bands away from your target. Consistent work is needed.`;
            }
            document.getElementById('gap-text').textContent = gapText;

            // Generate analysis displays
            generateBandGapAnalysis();
            generateRoadmap();
            generatePriorities();
            generateSchedule();

            // Switch to analysis tab
            document.querySelector('[onclick="showTab(\'analysis\')"]').click();
        }

        // Generate Band Gap Analysis
        function generateBandGapAnalysis() {
            const criteria = [
                { name: 'Task Response', code: 'tr', current: userScores.tr },
                { name: 'Coherence & Cohesion', code: 'cc', current: userScores.cc },
                { name: 'Lexical Resource', code: 'lr', current: userScores.lr },
                { name: 'Grammar Range & Accuracy', code: 'gra', current: userScores.gra }
            ];

            let html = '<div class="band-gap-display">';
            
            criteria.forEach(criterion => {
                const gap = userScores.target - criterion.current;
                const percentage = (criterion.current / 9) * 100;
                const targetPercentage = (userScores.target / 9) * 100;
                
                let gapClass = 'gap-small';
                let gapText = 'Small Gap';
                if (gap >= 2) {
                    gapClass = 'gap-large';
                    gapText = 'Large Gap';
                } else if (gap >= 1) {
                    gapClass = 'gap-medium';
                    gapText = 'Medium Gap';
                } else if (gap <= 0) {
                    gapClass = 'gap-small';
                    gapText = 'Target Reached!';
                }

                html += `
                    <div class="band-row">
                        <div class="band-label">${criterion.name}</div>
                        <div class="band-bar">
                            <div class="band-fill" style="width: ${percentage}%">Band ${criterion.current}</div>
                        </div>
                        <span class="gap-indicator ${gapClass}">${gap > 0 ? '+' + gap : gap} bands</span>
                    </div>
                `;
            });

            html += '</div>';

            // Add strengths and weaknesses
            const strengths = criteria.filter(c => (userScores.target - c.current) <= 0.5);
            const weaknesses = criteria.filter(c => (userScores.target - c.current) > 0.5);

            html += '<div style="margin-top: 30px;">';
            
            if (strengths.length > 0) {
                html += '<div class="feedback-card"><h4>Your Strengths</h4>';
                strengths.forEach(s => {
                    html += `<div class="strength-item">${s.name}: Band ${s.current} - At or near target level</div>`;
                });
                html += '</div>';
            }

            if (weaknesses.length > 0) {
                html += '<div class="feedback-card"><h4>Areas for Improvement</h4>';
                weaknesses.forEach(w => {
                    const gap = userScores.target - w.current;
                    html += `<div class="weakness-item">${w.name}: Band ${w.current} - Need +${gap} bands to reach target</div>`;
                });
                html += '</div>';
            }

            html += '</div>';

            document.getElementById('analysis-display').innerHTML = html;
        }

        // Generate Improvement Roadmap
        function generateRoadmap() {
            const criteria = [
                { name: 'Task Response', code: 'tr', current: userScores.tr },
                { name: 'Coherence & Cohesion', code: 'cc', current: userScores.cc },
                { name: 'Lexical Resource', code: 'lr', current: userScores.lr },
                { name: 'Grammar Range & Accuracy', code: 'gra', current: userScores.gra }
            ];

            // Sort by gap (largest first)
            const sortedCriteria = criteria.sort((a, b) => {
                const gapA = userScores.target - a.current;
                const gapB = userScores.target - b.current;
                return gapB - gapA;
            });

            const largestGap = sortedCriteria[0];
            const secondGap = sortedCriteria[1];

            let html = '<div class="roadmap-timeline">';

            // Phase 1: Address Largest Gap
            html += `
                <div class="roadmap-item">
                    <h4>PHASE 1: Focus on ${largestGap.name} (Weeks 1-3)</h4>
                    <p><strong>Your biggest gap is ${userScores.target - largestGap.current} bands in ${largestGap.name}.</strong></p>
                    <ul>
                        ${getRoadmapTasks(largestGap.code, 'phase1')}
                    </ul>
                </div>
            `;

            // Phase 2: Address Second Gap
            html += `
                <div class="roadmap-item">
                    <h4>PHASE 2: Improve ${secondGap.name} (Weeks 4-6)</h4>
                    <p><strong>Your second priority is ${userScores.target - secondGap.current} bands in ${secondGap.name}.</strong></p>
                    <ul>
                        ${getRoadmapTasks(secondGap.code, 'phase2')}
                    </ul>
                </div>
            `;

            // Phase 3: Integration
            html += `
                <div class="roadmap-item">
                    <h4>PHASE 3: Integration & Practice (Weeks 7-9)</h4>
                    <p><strong>Combine all skills and build exam confidence.</strong></p>
                    <ul>
                        <li>Write 2-3 complete timed essays per week</li>
                        <li>Practice all essay types under exam conditions</li>
                        <li>Get feedback from a teacher on each essay</li>
                        <li>Review and learn from your mistakes</li>
                        <li>Build your vocabulary and grammar notes</li>
                    </ul>
                </div>
            `;

            // Phase 4: Final Preparation
            html += `
                <div class="roadmap-item">
                    <h4>PHASE 4: Final Preparation (Weeks 10-12)</h4>
                    <p><strong>Fine-tune and build confidence for exam day.</strong></p>
                    <ul>
                        <li>Do 3-4 full mock exams (both tasks)</li>
                        <li>Identify and fix remaining errors</li>
                        <li>Practice time management strategies</li>
                        <li>Review all model essays and notes</li>
                        <li>Prepare mentally for exam day</li>
                    </ul>
                </div>
            `;

            html += '</div>';

            document.getElementById('roadmap-display').innerHTML = html;
        }

        // Get roadmap tasks based on criterion
        function getRoadmapTasks(criterion, phase) {
            const tasks = {
                tr: {
                    phase1: `
                        <li>Review Lesson 6-10 on essay types</li>
                        <li>Practice answering the question directly</li>
                        <li>Extend your ideas with explanations and examples</li>
                        <li>Write 3 practice essays focusing on Task Response</li>
                        <li>Ensure every paragraph directly answers the question</li>
                    `,
                    phase2: `
                        <li>Analyze 10 Band 8-9 model essays</li>
                        <li>Practice developing ideas fully (not just listing)</li>
                        <li>Work on writing relevant supporting details</li>
                    `
                },
                cc: {
                    phase1: `
                        <li>Review Lesson 5 on conclusions and linking</li>
                        <li>Study paragraph structure (TEEL method)</li>
                        <li>Practice using cohesive devices naturally</li>
                        <li>Write 3 practice essays focusing on organization</li>
                        <li>Check that each paragraph has one clear main idea</li>
                    `,
                    phase2: `
                        <li>Improve paragraph linking techniques</li>
                        <li>Practice reference words (this, these, such)</li>
                        <li>Work on creating flow between sentences</li>
                    `
                },
                lr: {
                    phase1: `
                        <li>Review Lesson 11 on vocabulary and collocations</li>
                        <li>Learn 20 new topic-related words per week</li>
                        <li>Practice paraphrasing question prompts</li>
                        <li>Avoid repetition - use synonyms and word forms</li>
                        <li>Write 3 practice essays focusing on vocabulary</li>
                    `,
                    phase2: `
                        <li>Build topic vocabulary lists (environment, technology, etc.)</li>
                        <li>Practice natural collocations</li>
                        <li>Use less common words appropriately</li>
                    `
                },
                gra: {
                    phase1: `
                        <li>Review Lesson 12 on complex sentences</li>
                        <li>Practice relative clauses and conditionals</li>
                        <li>Fix your most common grammar errors</li>
                        <li>Write 3 practice essays focusing on grammar</li>
                        <li>Aim for error-free sentences</li>
                    `,
                    phase2: `
                        <li>Increase variety of sentence structures</li>
                        <li>Practice complex-compound sentences</li>
                        <li>Work on punctuation accuracy</li>
                    `
                }
            };

            return tasks[criterion] ? tasks[criterion][phase] : '<li>Follow the general improvement plan</li>';
        }

        // Generate Priority Matrix
        function generatePriorities() {
            const criteria = [
                { name: 'Task Response', code: 'tr', current: userScores.tr },
                { name: 'Coherence & Cohesion', code: 'cc', current: userScores.cc },
                { name: 'Lexical Resource', code: 'lr', current: userScores.lr },
                { name: 'Grammar Range & Accuracy', code: 'gra', current: userScores.gra }
            ];

            const highImportant = criteria.filter(c => (userScores.target - c.current) >= 1);
            const lowImportant = criteria.filter(c => (userScores.target - c.current) < 1 && (userScores.target - c.current) > 0);

            let html = '<div class="priority-grid">';

            // High Importance + Urgent
            html += `
                <div class="priority-quadrant priority-high-urgent">
                    <h4>DO FIRST: High Importance + Urgent</h4>
                    <ul>
            `;
            if (highImportant.length > 0) {
                highImportant.forEach(c => {
                    html += `<li>Improve ${c.name} (Gap: ${userScores.target - c.current} bands)</li>`;
                });
            } else {
                html += '<li>Great! No critical gaps</li>';
            }
            html += '</ul></div>';

            // High Importance + Not Urgent
            html += `
                <div class="priority-quadrant priority-high-not-urgent">
                    <h4>SCHEDULE: High Importance + Not Urgent</h4>
                    <ul>
                        <li>Build vocabulary systematically</li>
                        <li>Read Band 8-9 model essays</li>
                        <li>Practice all essay types</li>
                        <li>Get regular feedback</li>
                    </ul>
                </div>
            `;

            // Low Importance + Urgent
            html += `
                <div class="priority-quadrant priority-low-urgent">
                    <h4>QUICK WINS: Low Importance + Urgent</h4>
                    <ul>
            `;
            if (lowImportant.length > 0) {
                lowImportant.forEach(c => {
                    html += `<li>Fine-tune ${c.name} (Gap: ${userScores.target - c.current} bands)</li>`;
                });
            } else {
                html += '<li>Maintain current strong areas</li>';
            }
            html += `
                        <li>Practice time management</li>
                        <li>Review exam format</li>
                    </ul>
                </div>
            `;

            // Low Importance + Not Urgent
            html += `
                <div class="priority-quadrant priority-low-not-urgent">
                    <h4>DO LATER: Low Importance + Not Urgent</h4>
                    <ul>
                        <li>Explore advanced grammar</li>
                        <li>Learn specialized vocabulary</li>
                        <li>Study additional essay techniques</li>
                        <li>Read IELTS preparation books</li>
                    </ul>
                </div>
            `;

            html += '</div>';

            document.getElementById('priority-display').innerHTML = html;
        }

        // Generate Weekly Schedule
        function generateSchedule() {
            const criteria = [
                { name: 'Task Response', code: 'tr', current: userScores.tr },
                { name: 'Coherence & Cohesion', code: 'cc', current: userScores.cc },
                { name: 'Lexical Resource', code: 'lr', current: userScores.lr },
                { name: 'Grammar Range & Accuracy', code: 'gra', current: userScores.gra }
            ];

            const largestGap = criteria.reduce((prev, current) => {
                return (userScores.target - current.current) > (userScores.target - prev.current) ? current : prev;
            });

            let html = `
                <div class="feedback-card">
                    <h4>Weekly Study Plan (Focus: ${largestGap.name})</h4>
                    <table style="width: 100%; margin-top: 15px; border-collapse: collapse;">
                        <tr style="background: #e8eaf6;">
                            <th style="padding: 12px; text-align: left; border: 1px solid #ddd;">Day</th>
                            <th style="padding: 12px; text-align: left; border: 1px solid #ddd;">Activity</th>
                            <th style="padding: 12px; text-align: left; border: 1px solid #ddd;">Duration</th>
                        </tr>
                        <tr>
                            <td style="padding: 10px; border: 1px solid #ddd;"><strong>Monday</strong></td>
                            <td style="padding: 10px; border: 1px solid #ddd;">Review lesson on ${largestGap.name} + Practice exercises</td>
                            <td style="padding: 10px; border: 1px solid #ddd;">60 min</td>
                        </tr>
                        <tr>
                            <td style="padding: 10px; border: 1px solid #ddd;"><strong>Tuesday</strong></td>
                            <td style="padding: 10px; border: 1px solid #ddd;">Write 1 timed practice essay (40 min) + Self-review (20 min)</td>
                            <td style="padding: 10px; border: 1px solid #ddd;">60 min</td>
                        </tr>
                        <tr>
                            <td style="padding: 10px; border: 1px solid #ddd;"><strong>Wednesday</strong></td>
                            <td style="padding: 10px; border: 1px solid #ddd;">Study vocabulary + Review model essays</td>
                            <td style="padding: 10px; border: 1px solid #ddd;">45 min</td>
                        </tr>
                        <tr>
                            <td style="padding: 10px; border: 1px solid #ddd;"><strong>Thursday</strong></td>
                            <td style="padding: 10px; border: 1px solid #ddd;">Write 1 timed practice essay (40 min) + Get teacher feedback</td>
                            <td style="padding: 10px; border: 1px solid #ddd;">60 min</td>
                        </tr>
                        <tr>
                            <td style="padding: 10px; border: 1px solid #ddd;"><strong>Friday</strong></td>
                            <td style="padding: 10px; border: 1px solid #ddd;">Grammar practice + Complex sentence drills</td>
                            <td style="padding: 10px; border: 1px solid #ddd;">45 min</td>
                        </tr>
                        <tr>
                            <td style="padding: 10px; border: 1px solid #ddd;"><strong>Saturday</strong></td>
                            <td style="padding: 10px; border: 1px solid #ddd;">Full mock exam (Task 1 + Task 2)</td>
                            <td style="padding: 10px; border: 1px solid #ddd;">90 min</td>
                        </tr>
                        <tr>
                            <td style="padding: 10px; border: 1px solid #ddd;"><strong>Sunday</strong></td>
                            <td style="padding: 10px; border: 1px solid #ddd;">Review mistakes from the week + Plan next week</td>
                            <td style="padding: 10px; border: 1px solid #ddd;">45 min</td>
                        </tr>
                    </table>
                    <p style="margin-top: 20px;"><strong>Total Time Commitment:</strong> Approximately 6-7 hours per week</p>
                </div>

                <div class="stats-row" style="margin-top: 30px;">
                    <div class="stat-box">
                        <div class="number">3</div>
                        <div class="label">Essays per Week</div>
                    </div>
                    <div class="stat-box">
                        <div class="number">6-7</div>
                        <div class="label">Hours per Week</div>
                    </div>
                    <div class="stat-box">
                        <div class="number">12</div>
                        <div class="label">Weeks to Target</div>
                    </div>
                </div>
            `;

            document.getElementById('schedule-display').innerHTML = html;
        }

        // Reset Scores
        function resetScores() {
            document.getElementById('tr-current').value = '';
            document.getElementById('cc-current').value = '';
            document.getElementById('lr-current').value = '';
            document.getElementById('gra-current').value = '';
            document.getElementById('target-score').value = '';
            document.getElementById('exam-date').value = '';
            document.getElementById('overall-score').style.display = 'none';
        }

        // Toggle Checklist Item
        function toggleCheck(element) {
            const checkbox = element.querySelector('input[type="checkbox"]');
            checkbox.checked = !checkbox.checked;
            
            if (checkbox.checked) {
                element.classList.add('completed');
            } else {
                element.classList.remove('completed');
            }

            updateCommitmentProgress();
        }

        // Update Commitment Progress
        function updateCommitmentProgress() {
            const total = document.querySelectorAll('.checklist-item').length;
            const checked = document.querySelectorAll('.checklist-item.completed').length;
            const percentage = Math.round((checked / total) * 100);

            const progressBar = document.getElementById('commitment-progress');
            progressBar.style.width = `${percentage}%`;
            progressBar.textContent = `${percentage}%`;
        }

        // Download Plan
        function downloadPlan() {
            if (!userScores.tr || !userScores.target) {
                alert('Please calculate your analysis first before downloading!');
                return;
            }

            const criteria = [
                { name: 'Task Response', code: 'tr', current: userScores.tr },
                { name: 'Coherence & Cohesion', code: 'cc', current: userScores.cc },
                { name: 'Lexical Resource', code: 'lr', current: userScores.lr },
                { name: 'Grammar Range & Accuracy', code: 'gra', current: userScores.gra }
            ];

            const overall = (userScores.tr + userScores.cc + userScores.lr + userScores.gra) / 4;
            const rounded = Math.round(overall * 2) / 2;

            let content = `MY IELTS WRITING TASK 2 IMPROVEMENT PLAN
==========================================

Generated: ${new Date().toLocaleDateString()}
Exam Date: ${userScores.examDate || 'Not scheduled yet'}

CURRENT SCORES
--------------
Task Response: Band ${userScores.tr}
Coherence & Cohesion: Band ${userScores.cc}
Lexical Resource: Band ${userScores.lr}
Grammar Range & Accuracy: Band ${userScores.gra}
OVERALL: Band ${rounded}

TARGET SCORE: Band ${userScores.target}
GAP TO TARGET: ${userScores.target - rounded} bands

PRIORITY AREAS
--------------
`;

            criteria.sort((a, b) => (userScores.target - b.current) - (userScores.target - a.current));
            criteria.forEach((c, index) => {
                const gap = userScores.target - c.current;
                content += `${index + 1}. ${c.name}: ${gap > 0 ? '+' + gap : gap} bands ${gap > 0 ? '(NEEDS WORK)' : '(GOOD!)'}\n`;
            });

            content += `
WEEKLY STUDY PLAN
-----------------
Monday: Review weakest criterion + Practice (60 min)
Tuesday: Timed essay practice + Self-review (60 min)
Wednesday: Vocabulary + Model essays (45 min)
Thursday: Timed essay + Teacher feedback (60 min)
Friday: Grammar practice (45 min)
Saturday: Full mock exam (90 min)
Sunday: Review mistakes + Plan next week (45 min)

Total: 6-7 hours per week

IMPROVEMENT ROADMAP
-------------------
Weeks 1-3: Focus on ${criteria[0].name}
Weeks 4-6: Focus on ${criteria[1].name}
Weeks 7-9: Integration and timed practice
Weeks 10-12: Final preparation and mock exams

MY COMMITMENTS
--------------
[ ] Follow roadmap consistently
[ ] Practice writing 3 times per week
[ ] Focus on weakest criterion first
[ ] Seek feedback regularly
[ ] Review model essays weekly
[ ] Do timed practice
[ ] Track progress every 2 weeks
[ ] Stay motivated!

---
Keep this plan visible and review it weekly!
Good luck with your preparation!
`;

            // Create download
            const blob = new Blob([content], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'IELTS_Improvement_Plan.txt';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);

            alert('Your improvement plan has been downloaded! Print it or save it where you can see it daily.');
        }
    </script>
</body>
</html>